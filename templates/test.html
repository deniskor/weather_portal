{% extends 'base.html' %}

{% block content %}
    <div id="res">
        <div class="card-body">
            <div class="d-flex flex-wrap justify-content-center">
                {% for obj in objs %}
                    <div class="card border-secondary text-center" style="width: 14rem;">
                        <div class="card-header">
                            <h3>{{ obj.temp|floatformat:"0" }}â„ƒ</h3>
                            {{ obj.dt|date:"m-d-Y H:i" }}<br>
                            <strong>{{ obj.city.name }}</strong>
                        </div>
                        <div class="card-body text-secondary">
                            Clouds {{ obj.clouds }}% <br>
                            Wind {{ obj.wind }}m/s.<br>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <div id='pagination'>
        {##}
    </div>

{% endblock %}

{% block script %}
    <script>
        $("#results_page").addClass("active");
        let urlParams = new URLSearchParams(window.location.search);
        let current_page = 1;
        console.log(current_page);
        let params_str = urlParams.toString();
        let page_cnt = 0;

        function render_paginator() {
            let el = $('#pagination');
            el.empty();

            let start_range = current_page <= 5?
                1: Math.abs(current_page-page_cnt) <= 5? page_cnt-10:current_page - 5;
            let end_range = start_range + 10 <= page_cnt? start_range + 10 : page_cnt;

            let render_str = `
                <div class="pagination justify-content-center">
                    <ul class="pagination justify-content-center">`;


            render_str += `
                <li class="page-item">
                    <a class="page-link" href="?page=1">1</a>
                </li>`;

            for (let i = start_range; i <= end_range; i++) {
                {#let url = params_str.replace('page=');#}
                let active = i == current_page ? 'active' : '';
                render_str += `
                    <li class="page-item ${active}">
                        <a class="page-link" href="?page=${i}">${i}</a>
                    </li>`;
            }
            render_str += `
                <li class="page-item">
                    <a class="page-link" href="?page=${page_cnt}">${page_cnt}</a>
                </li>`;
            render_str += '</div></div>';
            el.append(render_str)
        }

        function get_paginator() {
            let url = `{% url 'results' %}?${urlParams.toString()}`;
            $.ajax({
                url: url,
                type: 'GET',
                success: function (data) {
                    console.log(data);
                    page_cnt = data['page_cnt'];
                    current_page = data['curr_page'];
                    render_paginator();
                }
            });
        }

        get_paginator()
    </script>
{% endblock %}
