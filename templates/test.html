{% extends 'base.html' %}

{% block content %}
<div id="date_weather"></div>
{% endblock %}

{% block script %}
    <script>
        $("#results_page").addClass("active");

        $.ajax({
            url: '{% url 'results' %}',
            type: 'GET',
            success: function (data) {
                console.log(data);
                if (data['code'] === '200') {
                    draw_result($('#date_weather'), data);
                } else if (data['code'] === '404') {
                    $('#date_weather').empty();
                    $('#date_weather').append(`
                                    <div class="alert alert-danger text-center" role="alert">
                                          ${data['msg'].charAt(0).toUpperCase() + data['msg'].slice(1)}
                                    </div>`);
                }
            }
        });

        function draw_wather(el, data) {
            let s = `<div class="card-body ">
                             <div class="d-flex flex-wrap justify-content-center">
                                  <div class="card-group">`;

            data['list'].forEach(function (element) {
                let card_s = `
                        <div class="card border-secondary text-center" style="width: 14rem;">
                            <div class="card-header">
                                <h3>${element['temp']}â„ƒ</h3>
                                    ${element['time']}
                            </div>
                            <div class="card-body text-secondary">
                                <p class="card-text">Clouds ${element['clouds']}%.</p>
                                <p class="card-text">Wind ${element['wind']}m/s.</p>
                            </div>
                        </div>`;
                s += card_s;
            });

            $(el).append(s.concat("</div></div></div>"))
        }

        let draw_result = function (el, data) {
            $(el).empty();
            $(el).append(`<div class="card">`);
            data['items'].forEach(function (element) {
                $(el).append(`<div class="card-header alert-primary"> ${element['date']} </div>`);
                draw_wather(el, element);
            });
            $(el).append(`</div>`);
        };


    </script>
{% endblock %}
